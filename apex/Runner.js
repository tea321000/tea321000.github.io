"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Runner = void 0;
const app = require("lib");
const ui = require("ui");
class Runner {
    constructor(canvas = document.getElementById('canvas'), map = new app.features.Map(canvas), radar = new app.features.Radar(canvas), recoil = new app.features.Recoil(), sense = new app.features.Sense(), aimbot = new app.features.Aimbot()) {
        this.canvas = canvas;
        this.map = map;
        this.radar = radar;
        this.recoil = recoil;
        this.sense = sense;
        this.aimbot = aimbot;
    }
    static create() {
        const source = new Runner();
        source.attach();
        return source.run.bind(source);
    }
    run(core, vm) {
        const localPlayer = core.playerList.get(core.localPlayer.value);
        this.updateResearch(core, vm, localPlayer);
        this.updateSense(core, vm, localPlayer);
        this.updateAimbot(core, vm, localPlayer);
        this.canvas.height = window.innerHeight;
        this.canvas.width = window.innerWidth;
        this.update(core, vm, localPlayer);
    }
    attach() {
        this.canvas.addEventListener('dblclick', () => {
            (document.fullscreenElement
                ? document.exitFullscreen()
                : document.body.requestFullscreen()).catch();
        });
    }
    update(core, vm, localPlayer) {
        switch (vm.settings.general.viewType.value) {
            case ui.settings.general.MainType.Map:
                this.map.refresh(core.levelName.value);
                this.updateMap(core, vm, localPlayer);
                break;
            case ui.settings.general.MainType.Radar:
                this.radar.refresh();
                this.updateRadar(core, vm, localPlayer);
                break;
        }
    }
    updateMap(core, vm, localPlayer) {
        if (vm.settings.general.map.showItems.value)
            this.map.renderItems(core.itemList.values(), vm.settings.itemSet);
        if (vm.settings.general.map.showPlayers.value && localPlayer)
            this.map.renderPlayers(localPlayer, core.playerList.values());
    }
    updateRadar(core, vm, localPlayer) {
        if (vm.settings.general.radar.showItems.value && localPlayer)
            this.radar.renderItems(localPlayer, core.itemList.values(), vm.settings.itemSet);
        if (vm.settings.general.radar.showPlayers.value && localPlayer)
            this.radar.renderNpcs(localPlayer, core.npcList.values());
        if (vm.settings.general.radar.showPlayers.value && localPlayer)
            this.radar.renderPlayers(localPlayer, core.playerList.values());
    }
    updateResearch(core, vm, localPlayer) {
        if (vm.settings.research.recoil.enable.value && localPlayer && vm.settings.research.recoil.options)
            this.recoil.update(core.buttonList, localPlayer, vm.settings.research.recoil.options);
    }
    updateSense(core, vm, localPlayer) {
        const itemsFn = vm.settings.general.sense.highlightItems.value
            ? this.sense.updateItems.bind(this.sense)
            : this.sense.resetItems.bind(this.sense);
        const playersFn = vm.settings.general.sense.highlightPlayers.value
            ? this.sense.updatePlayers.bind(this.sense)
            : this.sense.resetPlayers.bind(this.sense);
        if (localPlayer) {
            itemsFn(localPlayer, core.itemList.values(), vm.settings.itemSet);
            playersFn(localPlayer, core.playerList.values());
        }
    }
    updateAimbot(core, vm, localPlayer) {
        let aimbot_enabled = vm.settings.general.aimbot.aimbotEnable.value;
        if (localPlayer && aimbot_enabled) {
            this.aimbot.updateStates(core.levelName.value, localPlayer, core.playerList.values());
        }
    }
}
exports.Runner = Runner;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUnVubmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL1J1bm5lci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSwyQkFBMkI7QUFDM0IseUJBQXlCO0FBRXpCLE1BQWEsTUFBTTtJQUNqQixZQUNtQixTQUFTLFFBQVEsQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFzQixFQUMvRCxNQUFNLElBQUksR0FBRyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQ2xDLFFBQVEsSUFBSSxHQUFHLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsRUFDdEMsU0FBUyxJQUFJLEdBQUcsQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLEVBQ2xDLFFBQVEsSUFBSSxHQUFHLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRSxFQUNoQyxTQUFTLElBQUksR0FBRyxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUU7UUFMbEMsV0FBTSxHQUFOLE1BQU0sQ0FBeUQ7UUFDL0QsUUFBRyxHQUFILEdBQUcsQ0FBK0I7UUFDbEMsVUFBSyxHQUFMLEtBQUssQ0FBaUM7UUFDdEMsV0FBTSxHQUFOLE1BQU0sQ0FBNEI7UUFDbEMsVUFBSyxHQUFMLEtBQUssQ0FBMkI7UUFDaEMsV0FBTSxHQUFOLE1BQU0sQ0FBNEI7SUFBSSxDQUFDO0lBRTFELE1BQU0sQ0FBQyxNQUFNO1FBQ1gsTUFBTSxNQUFNLEdBQUcsSUFBSSxNQUFNLEVBQUUsQ0FBQztRQUM1QixNQUFNLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDaEIsT0FBTyxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNqQyxDQUFDO0lBRUQsR0FBRyxDQUFDLElBQW1CLEVBQUUsRUFBb0I7UUFDM0MsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNoRSxJ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SztZQUNoRSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUM7WUFDM0MsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDN0MsSUFBSSxXQUFXLEVBQUU7WUFDZixPQUFPLENBQUMsV0FBVyxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLEVBQUUsRUFBRSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNsRSxTQUFTLENBQUMsV0FBVyxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQztTQUNsRDtJQUNILENBQUM7SUFFTyxZQUFZLENBQUMsSUFBbUIsRUFBRSxFQUFvQixFQUFFLFdBQTZCO1FBQzNGLElBQUksY0FBYyxHQUFHLEVBQUUsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDO1FBQ25FLElBQUksV0FBVyxJQUFJLGNBQWMsRUFBRTtZQUNqQyxJQUFJLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxXQUFXLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO1NBQ3ZGO0lBQ0gsQ0FBQztDQUNGO0FBdEZELHdCQXNGQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGFwcCBmcm9tICdsaWInO1xyXG5pbXBvcnQgKiBhcyB1aSBmcm9tICd1aSc7XHJcblxyXG5leHBvcnQgY2xhc3MgUnVubmVyIHtcclxuICBwcml2YXRlIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSByZWFkb25seSBjYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FudmFzJykgYXMgSFRNTENhbnZhc0VsZW1lbnQsXHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IG1hcCA9IG5ldyBhcHAuZmVhdHVyZXMuTWFwKGNhbnZhcyksXHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IHJhZGFyID0gbmV3IGFwcC5mZWF0dXJlcy5SYWRhcihjYW52YXMpLFxyXG4gICAgcHJpdmF0ZSByZWFkb25seSByZWNvaWwgPSBuZXcgYXBwLmZlYXR1cmVzLlJlY29pbCgpLFxyXG4gICAgcHJpdmF0ZSByZWFkb25seSBzZW5zZSA9IG5ldyBhcHAuZmVhdHVyZXMuU2Vuc2UoKSxcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgYWltYm90ID0gbmV3IGFwcC5mZWF0dXJlcy5BaW1ib3QoKSwpIHt9XHJcbiAgXHJcbiAgc3RhdGljIGNyZWF0ZSgpIHtcclxuICAgIGNvbnN0IHNvdXJjZSA9IG5ldyBSdW5uZXIoKTtcclxuICAgIHNvdXJjZS5hdHRhY2goKTtcclxuICAgIHJldHVybiBzb3VyY2UucnVuLmJpbmQoc291cmNlKTtcclxuICB9XHJcblxyXG4gIHJ1bihjb3JlOiBhcHAuY29yZS5Db3JlLCB2bTogdWkuTWFpblZpZXdNb2RlbCkge1xyXG4gICAgY29uc3QgbG9jYWxQbGF5ZXIgPSBjb3JlLnBsYXllckxpc3QuZ2V0KGNvcmUubG9jYWxQbGF5ZXIudmFsdWUpO1xyXG4gICAgdGhpcy51cGRhdGVSZXNlYXJjaChjb3JlLCB2bSwgbG9jYWxQbGF5ZXIpO1xyXG4gICAgdGhpcy51cGRhdGVTZW5zZShjb3JlLCB2bSwgbG9jYWxQbGF5ZXIpO1xyXG4gICAgdGhpcy51cGRhdGVBaW1ib3QoY29yZSwgdm0sIGxvY2FsUGxheWVyKTtcclxuICAgIHRoaXMuY2FudmFzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcclxuICAgIHRoaXMuY2FudmFzLndpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XHJcbiAgICB0aGlzLnVwZGF0ZShjb3JlLCB2bSwgbG9jYWxQbGF5ZXIpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhdHRhY2goKSB7XHJcbiAgICB0aGlzLmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdkYmxjbGljaycsICgpID0+IHtcclxuICAgICAgKGRvY3VtZW50LmZ1bGxzY3JlZW5FbGVtZW50XHJcbiAgICAgICAgPyBkb2N1bWVudC5leGl0RnVsbHNjcmVlbigpXHJcbiAgICAgICAgOiBkb2N1bWVudC5ib2R5LnJlcXVlc3RGdWxsc2NyZWVuKCkpLmNhdGNoKCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgdXBkYXRlKGNvcmU6IGFwcC5jb3JlLkNvcmUsIHZtOiB1aS5NYWluVmlld01vZGVsLCBsb2NhbFBsYXllcj86IGFwcC5jb3JlLlBsYXllcikge1xyXG4gICAgc3dpdGNoICh2bS5zZXR0aW5ncy5nZW5lcmFsLnZpZXdUeXBlLnZhbHVlKSB7XHJcbiAgICAgIGNhc2UgdWkuc2V0dGluZ3MuZ2VuZXJhbC5NYWluVHlwZS5NYXA6XHJcbiAgICAgICAgdGhpcy5tYXAucmVmcmVzaChjb3JlLmxldmVsTmFtZS52YWx1ZSk7XHJcbiAgICAgICAgdGhpcy51cGRhdGVNYXAoY29yZSwgdm0sIGxvY2FsUGxheWVyKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSB1aS5zZXR0aW5ncy5nZW5lcmFsLk1haW5UeXBlLlJhZGFyOlxyXG4gICAgICAgIHRoaXMucmFkYXIucmVmcmVzaCgpO1xyXG4gICAgICAgIHRoaXMudXBkYXRlUmFkYXIoY29yZSwgdm0sIGxvY2FsUGxheWVyKTtcclxuICAgICAgICBicmVhaztcclxuICAgIH1cclxuICB9XHJcbiAgXHJcbiAgcHJpdmF0ZSB1cGRhdGVNYXAoY29yZTogYXBwLmNvcmUuQ29yZSwgdm06IHVpLk1haW5WaWV3TW9kZWwsIGxvY2FsUGxheWVyPzogYXBwLmNvcmUuUGxheWVyKSB7XHJcbiAgICBpZiAodm0uc2V0dGluZ3MuZ2VuZXJhbC5tYXAuc2hvd0l0ZW1zLnZhbHVlKVxyXG4gICAgICB0aGlzLm1hcC5yZW5kZXJJdGVtcyhjb3JlLml0ZW1MaXN0LnZhbHVlcygpLCB2bS5zZXR0aW5ncy5pdGVtU2V0KTtcclxuICAgIGlmICh2bS5zZXR0aW5ncy5nZW5lcmFsLm1hcC5zaG93UGxheWVycy52YWx1ZSAmJiBsb2NhbFBsYXllcilcclxuICAgICAgdGhpcy5tYXAucmVuZGVyUGxheWVycyhsb2NhbFBsYXllciwgY29yZS5wbGF5ZXJMaXN0LnZhbHVlcygpKTtcclxuICB9XHJcbiAgXHJcbiAgcHJpdmF0ZSB1cGRhdGVSYWRhcihjb3JlOiBhcHAuY29yZS5Db3JlLCB2bTogdWkuTWFpblZpZXdNb2RlbCwgbG9jYWxQbGF5ZXI/OiBhcHAuY29yZS5QbGF5ZXIpIHtcclxuICAgIGlmICh2bS5zZXR0aW5ncy5nZW5lcmFsLnJhZGFyLnNob3dJdGVtcy52YWx1ZSAmJiBsb2NhbFBsYXllcilcclxuICAgICAgdGhpcy5yYWRhci5yZW5kZXJJdGVtcyhsb2NhbFBsYXllciwgY29yZS5pdGVtTGlzdC52YWx1ZXMoKSwgdm0uc2V0dGluZ3MuaXRlbVNldCk7XHJcbiAgICBpZiAodm0uc2V0dGluZ3MuZ2VuZXJhbC5yYWRhci5zaG93UGxheWVycy52YWx1ZSAmJiBsb2NhbFBsYXllcilcclxuICAgICAgdGhpcy5yYWRhci5yZW5kZXJOcGNzKGxvY2FsUGxheWVyLCBjb3JlLm5wY0xpc3QudmFsdWVzKCkpO1xyXG4gICAgaWYgKHZtLnNldHRpbmdzLmdlbmVyYWwucmFkYXIuc2hvd1BsYXllcnMudmFsdWUgJiYgbG9jYWxQbGF5ZXIpXHJcbiAgICAgIHRoaXMucmFkYXIucmVuZGVyUGxheWVycyhsb2NhbFBsYXllciwgY29yZS5wbGF5ZXJMaXN0LnZhbHVlcygpKTtcclxuICB9XHJcbiAgXHJcbiAgcHJpdmF0ZSB1cGRhdGVSZXNlYXJjaChjb3JlOiBhcHAuY29yZS5Db3JlLCB2bTogdWkuTWFpblZpZXdNb2RlbCwgbG9jYWxQbGF5ZXI/OiBhcHAuY29yZS5QbGF5ZXIpIHtcclxuICAgIGlmICh2bS5zZXR0aW5ncy5yZXNlYXJjaC5yZWNvaWwuZW5hYmxlLnZhbHVlICYmIGxvY2FsUGxheWVyICYmIHZtLnNldHRpbmdzLnJlc2VhcmNoLnJlY29pbC5vcHRpb25zKVxyXG4gICAgICB0aGlzLnJlY29pbC51cGRhdGUoY29yZS5idXR0b25MaXN0LCBsb2NhbFBsYXllciwgdm0uc2V0dGluZ3MucmVzZWFyY2gucmVjb2lsLm9wdGlvbnMpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSB1cGRhdGVTZW5zZShjb3JlOiBhcHAuY29yZS5Db3JlLCB2bTogdWkuTWFpblZpZXdNb2RlbCwgbG9jYWxQbGF5ZXI/OiBhcHAuY29yZS5QbGF5ZXIpIHtcclxuICAgIGNvbnN0IGl0ZW1zRm4gPSB2bS5zZXR0aW5ncy5nZW5lcmFsLnNlbnNlLmhpZ2hsaWdodEl0ZW1zLnZhbHVlXHJcbiAgICAgID8gdGhpcy5zZW5zZS51cGRhdGVJdGVtcy5iaW5kKHRoaXMuc2Vuc2UpXHJcbiAgICAgIDogdGhpcy5zZW5zZS5yZXNldEl0ZW1zLmJpbmQodGhpcy5zZW5zZSk7XHJcbiAgICBjb25zdCBwbGF5ZXJzRm4gPSB2bS5zZXR0aW5ncy5nZW5lcmFsLnNlbnNlLmhpZ2hsaWdodFBsYXllcnMudmFsdWVcclxuICAgICAgPyB0aGlzLnNlbnNlLnVwZGF0ZVBsYXllcnMuYmluZCh0aGlzLnNlbnNlKVxyXG4gICAgICA6IHRoaXMuc2Vuc2UucmVzZXRQbGF5ZXJzLmJpbmQodGhpcy5zZW5zZSk7XHJcbiAgICBpZiAobG9jYWxQbGF5ZXIpIHtcclxuICAgICAgaXRlbXNGbihsb2NhbFBsYXllciwgY29yZS5pdGVtTGlzdC52YWx1ZXMoKSwgdm0uc2V0dGluZ3MuaXRlbVNldCk7XHJcbiAgICAgIHBsYXllcnNGbihsb2NhbFBsYXllciwgY29yZS5wbGF5ZXJMaXN0LnZhbHVlcygpKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgdXBkYXRlQWltYm90KGNvcmU6IGFwcC5jb3JlLkNvcmUsIHZtOiB1aS5NYWluVmlld01vZGVsLCBsb2NhbFBsYXllcj86IGFwcC5jb3JlLlBsYXllcikge1xyXG4gICAgbGV0IGFpbWJvdF9lbmFibGVkID0gdm0uc2V0dGluZ3MuZ2VuZXJhbC5haW1ib3QuYWltYm90RW5hYmxlLnZhbHVlO1xyXG4gICAgaWYgKGxvY2FsUGxheWVyICYmIGFpbWJvdF9lbmFibGVkKSB7XHJcbiAgICAgIHRoaXMuYWltYm90LnVwZGF0ZVN0YXRlcyhjb3JlLmxldmVsTmFtZS52YWx1ZSwgbG9jYWxQbGF5ZXIsIGNvcmUucGxheWVyTGlzdC52YWx1ZXMoKSk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdfQ==