"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.EntityMember = void 0;
const app = require("..");
class EntityMember {
    constructor(offset, interval, size) {
        this.buffer = new DataView(new ArrayBuffer(size));
        this.interval = interval;
        this.offset = offset;
    }
    receive(packet) {
        if (packet instanceof app.EntityUpdateEntityMember) {
            this.receiveUpdate(packet);
        }
        else {
            this.receiveSync(packet);
        }
    }
    update(syncId) {
        if (!this.send)
            return;
        const packet = new app.EntityChangeMember(this.offset, this.buffer, this.deltas);
        this.deltas = undefined;
        this.send = false;
        this.syncId = syncId;
        return packet;
    }
    receiveUpdate(packet) {
        if (typeof this.syncId !== 'undefined')
            return;
        if (packet.buffer.byteLength !== this.buffer.byteLength)
            return;
        for (let i = 0; i < packet.buffer.byteLength; i++)
            this.buffer.setUint8(i, packet.buffer.getUint8(i));
    }
    receiveSync(packet) {
        if (this.syncId !== packet.id)
            return;
        this.syncId = undefined;
    }
}
exports.EntityMember = EntityMember;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRW50aXR5TWVtYmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2xpYi9hcGkvY2xhc3Nlcy9FbnRpdHlNZW1iZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsMEJBQTBCO0FBRTFCLE1BQWEsWUFBWTtJQVF2QixZQUFZLE1BQWMsRUFBRSxRQUFnQixFQUFFLElBQVk7UUFDeEQsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLFFBQVEsQ0FBQyxJQUFJLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ2xELElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO1FBQ3pCLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO0lBQ3ZCLENBQUM7SUFFRCxPQUFPLENBQUMsTUFBb0Q7UUFDMUQsSUFBSSxNQUFNLFlBQVksR0FBRyxDQUFDLHdCQUF3QixFQUFFO1lBQ2xELElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDNUI7YUFBTTtZQUNMLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDMUI7SUFDSCxDQUFDO0lBRUQsTUFBTSxDQUFDLE1BQWM7UUFDbkIsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJO1lBQUUsT0FBTztRQUN2QixNQUFNLE1BQU0sR0FBRyxJQUFJLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2pGLElBQUksQ0FBQyxNQUFNLEdBQUcsU0FBUyxDQUFDO1FBQ3hCLElBQUksQ0FBQyxJQUFJLEdBQUcsS0FBSyxDQUFDO1FBQ2xCLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBQ3JCLE9BQU8sTUFBTSxDQUFDO0lBQ2hCLENBQUM7SUFFTyxhQUFhLENBQUMsTUFBb0M7UUFDeEQsSUFBSSxPQUFPLElBQUksQ0FBQyxNQUFNLEtBQUssV0FBVztZQUFFLE9BQU87UUFDL0MsSUFBSSxNQUFNLENBQUMsTUFBTSxDQUFDLFVBQVUsS0FBSyxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVU7WUFBRSxPQUFPO1FBQ2hFLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLFVBQVUsRUFBRSxDQUFDLEVBQUU7WUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN4RyxDQUFDO0lBRU8sV0FBVyxDQUFDLE1BQXFCO1FBQ3ZDLElBQUksSUFBSSxDQUFDLE1BQU0sS0FBSyxNQUFNLENBQUMsRUFBRTtZQUFFLE9BQU87UUFDdEMsSUFBSSxDQUFDLE1BQU0sR0FBRyxTQUFTLENBQUM7SUFDMUIsQ0FBQztDQUNGO0FBekNELG9DQXlDQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGFwcCBmcm9tICcuLic7XHJcblxyXG5leHBvcnQgY2xhc3MgRW50aXR5TWVtYmVyIHtcclxuICByZWFkb25seSBidWZmZXI6IERhdGFWaWV3O1xyXG4gIHJlYWRvbmx5IGludGVydmFsOiBudW1iZXI7XHJcbiAgcmVhZG9ubHkgb2Zmc2V0OiBudW1iZXI7XHJcbiAgZGVsdGFzPzogQXJyYXk8YXBwLkVudGl0eUNoYW5nZU1lbWJlckRlbHRhPjtcclxuICBzZW5kPzogYm9vbGVhbjtcclxuICBzeW5jSWQ/OiBudW1iZXI7XHJcblxyXG4gIGNvbnN0cnVjdG9yKG9mZnNldDogbnVtYmVyLCBpbnRlcnZhbDogbnVtYmVyLCBzaXplOiBudW1iZXIpIHtcclxuICAgIHRoaXMuYnVmZmVyID0gbmV3IERhdGFWaWV3KG5ldyBBcnJheUJ1ZmZlcihzaXplKSk7XHJcbiAgICB0aGlzLmludGVydmFsID0gaW50ZXJ2YWw7XHJcbiAgICB0aGlzLm9mZnNldCA9IG9mZnNldDtcclxuICB9XHJcblxyXG4gIHJlY2VpdmUocGFja2V0OiBhcHAuQmFzaWNTeW5jIHwgYXBwLkVudGl0eVVwZGF0ZUVudGl0eU1lbWJlcikge1xyXG4gICAgaWYgKHBhY2tldCBpbnN0YW5jZW9mIGFwcC5FbnRpdHlVcGRhdGVFbnRpdHlNZW1iZXIpIHtcclxuICAgICAgdGhpcy5yZWNlaXZlVXBkYXRlKHBhY2tldCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnJlY2VpdmVTeW5jKHBhY2tldCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICB1cGRhdGUoc3luY0lkOiBudW1iZXIpIHtcclxuICAgIGlmICghdGhpcy5zZW5kKSByZXR1cm47XHJcbiAgICBjb25zdCBwYWNrZXQgPSBuZXcgYXBwLkVudGl0eUNoYW5nZU1lbWJlcih0aGlzLm9mZnNldCwgdGhpcy5idWZmZXIsIHRoaXMuZGVsdGFzKTtcclxuICAgIHRoaXMuZGVsdGFzID0gdW5kZWZpbmVkO1xyXG4gICAgdGhpcy5zZW5kID0gZmFsc2U7XHJcbiAgICB0aGlzLnN5bmNJZCA9IHN5bmNJZDtcclxuICAgIHJldHVybiBwYWNrZXQ7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHJlY2VpdmVVcGRhdGUocGFja2V0OiBhcHAuRW50aXR5VXBkYXRlRW50aXR5TWVtYmVyKSB7XHJcbiAgICBpZiAodHlwZW9mIHRoaXMuc3luY0lkICE9PSAndW5kZWZpbmVkJykgcmV0dXJuO1xyXG4gICAgaWYgKHBhY2tldC5idWZmZXIuYnl0ZUxlbmd0aCAhPT0gdGhpcy5idWZmZXIuYnl0ZUxlbmd0aCkgcmV0dXJuO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYWNrZXQuYnVmZmVyLmJ5dGVMZW5ndGg7IGkrKykgdGhpcy5idWZmZXIuc2V0VWludDgoaSwgcGFja2V0LmJ1ZmZlci5nZXRVaW50OChpKSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHJlY2VpdmVTeW5jKHBhY2tldDogYXBwLkJhc2ljU3luYykge1xyXG4gICAgaWYgKHRoaXMuc3luY0lkICE9PSBwYWNrZXQuaWQpIHJldHVybjtcclxuICAgIHRoaXMuc3luY0lkID0gdW5kZWZpbmVkO1xyXG4gIH1cclxufVxyXG4iXX0=