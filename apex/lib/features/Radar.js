"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Radar = void 0;
class Radar {
    constructor(canvas, maximumDistance = 200, numberOfRings = 8) {
        this.canvas = canvas;
        this.maximumDistance = maximumDistance;
        this.numberOfRings = numberOfRings;
        this.centerX = 0;
        this.centerY = 0;
        this.outerRadius = 0;
        this.context = canvas.getContext('2d');
    }
    refresh() {
        this.update();
        this.renderBackground();
        this.renderLines();
        this.renderRings();
    }
    renderAll(localPlayer, players) {
        for (const x of players) {
            if (x.address === localPlayer.address)
                continue;
            this.renderOne(localPlayer, x.localOrigin.value, x.createColor(localPlayer));
        }
    }
    renderOne(localPlayer, localOrigin, style) {
        const dx = (localPlayer.localOrigin.value.x - localOrigin.x) * 0.0254;
        const dy = (localPlayer.localOrigin.value.y - localOrigin.y) * 0.0254;
        const r = Math.sqrt(Math.pow(dx, 2) + Math.pow(dy, 2));
        if (r < this.maximumDistance) {
            const s = this.outerRadius / this.maximumDistance;
            const a = Math.sign(dy) * Math.acos(dx / r) - localPlayer.viewAngles.value.y * Math.PI / 180;
            const x = this.centerX + Math.sin(a) * r * s;
            const y = this.centerY + Math.cos(a) * r * s;
            this.context.beginPath();
            this.context.arc(x, y, this.outerRadius / 40, 0, Math.PI * 2);
            this.context.fillStyle = style;
            this.context.fill();
        }
    }
    renderBackground() {
        this.context.beginPath();
        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
        this.context.arc(this.centerX, this.centerY, this.outerRadius, 0, Math.PI * 2);
        this.context.fillStyle = '#000';
        this.context.fill();
    }
    renderLines() {
        this.context.strokeStyle = '#FFF';
        for (let i = 0; i < 8; i++) {
            const x = this.centerX + this.outerRadius * Math.cos(i * Math.PI * 0.25);
            const y = this.centerY + this.outerRadius * Math.sin(i * Math.PI * 0.25);
            this.context.beginPath();
            this.context.moveTo(this.centerX, this.centerY);
            this.context.lineTo(x, y);
            this.context.stroke();
        }
    }
    renderRings() {
        this.context.strokeStyle = '#FFF';
        for (let i = 1; i <= this.numberOfRings; i++) {
            this.context.beginPath();
            this.context.arc(this.centerX, this.centerY, this.outerRadius * i / this.numberOfRings, 0, Math.PI * 2);
            this.context.stroke();
        }
    }
    update() {
        this.centerX = this.canvas.width / 2;
        this.centerY = this.canvas.height / 2;
        this.outerRadius = (this.canvas.width > this.canvas.height ? this.canvas.height : this.canvas.width) / 2;
    }
}
exports.Radar = Radar;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmFkYXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvbGliL2ZlYXR1cmVzL1JhZGFyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUVBLE1BQWEsS0FBSztJQU1oQixZQUNtQixNQUF5QixFQUN6QixrQkFBa0IsR0FBRyxFQUNyQixnQkFBZ0IsQ0FBQztRQUZqQixXQUFNLEdBQU4sTUFBTSxDQUFtQjtRQUN6QixvQkFBZSxHQUFmLGVBQWUsQ0FBTTtRQUNyQixrQkFBYSxHQUFiLGFBQWEsQ0FBSTtRQVA1QixZQUFPLEdBQUcsQ0FBQyxDQUFDO1FBQ1osWUFBTyxHQUFHLENBQUMsQ0FBQztRQUNaLGdCQUFXLEdBQUcsQ0FBQyxDQUFDO1FBTXRCLElBQUksQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUUsQ0FBQztJQUMxQyxDQUFDO0lBRUQsT0FBTztRQUNMLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUNkLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQ3hCLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNuQixJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDckIsQ0FBQztJQUVELFNBQVMsQ0FBQyxXQUE0QixFQUFFLE9BQStCO1FBQ3JFLEtBQUssTUFBTSxDQUFDLElBQUksT0FBTyxFQUFFO1lBQ3ZCLElBQUksQ0FBQyxDQUFDLE9BQU8sS0FBSyxXQUFXLENBQUMsT0FBTztnQkFBRSxTQUFTO1lBQ2hELElBQUksQ0FBQyxTQUFTLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztTQUM5RTtJQUNILENBQUM7SUFFRCxTQUFTLENBQUMsV0FBNEIsRUFBRSxXQUE2QixFQUFFLEtBQThDO1FBQ25ILE1BQU0sRUFBRSxHQUFHLENBQUMsV0FBVyxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsR0FBRyxNQUFNLENBQUM7UUFDdEUsTUFBTSxFQUFFLEdBQUcsQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQztRQUN0RSxNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDdkQsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLGVBQWUsRUFBRTtZQUM1QixNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUM7WUFDbEQsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxXQUFXLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEVBQUUsR0FBRyxHQUFHLENBQUM7WUFDN0YsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDN0MsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDN0MsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUN6QixJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxXQUFXLEdBQUcsRUFBRSxFQUFFLENBQUMsRUFBRSxJQUFJ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QUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDM0csQ0FBQztDQUNGO0FBN0VELHNCQTZFQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGFwcCBmcm9tICcuLic7XHJcblxyXG5leHBvcnQgY2xhc3MgUmFkYXIge1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgY29udGV4dDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEO1xyXG4gIHByaXZhdGUgY2VudGVyWCA9IDA7XHJcbiAgcHJpdmF0ZSBjZW50ZXJZID0gMDtcclxuICBwcml2YXRlIG91dGVyUmFkaXVzID0gMDtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQsXHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IG1heGltdW1EaXN0YW5jZSA9IDIwMCxcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgbnVtYmVyT2ZSaW5ncyA9IDgpIHtcclxuICAgIHRoaXMuY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpITtcclxuICB9XHJcblxyXG4gIHJlZnJlc2goKSB7XHJcbiAgICB0aGlzLnVwZGF0ZSgpO1xyXG4gICAgdGhpcy5yZW5kZXJCYWNrZ3JvdW5kKCk7XHJcbiAgICB0aGlzLnJlbmRlckxpbmVzKCk7XHJcbiAgICB0aGlzLnJlbmRlclJpbmdzKCk7XHJcbiAgfVxyXG5cclxuICByZW5kZXJBbGwobG9jYWxQbGF5ZXI6IGFwcC5jb3JlLlBsYXllciwgcGxheWVyczogQXJyYXk8YXBwLmNvcmUuUGxheWVyPikge1xyXG4gICAgZm9yIChjb25zdCB4IG9mIHBsYXllcnMpIHtcclxuICAgICAgaWYgKHguYWRkcmVzcyA9PT0gbG9jYWxQbGF5ZXIuYWRkcmVzcykgY29udGludWU7XHJcbiAgICAgIHRoaXMucmVuZGVyT25lKGxvY2FsUGxheWVyLCB4LmxvY2FsT3JpZ2luLnZhbHVlLCB4LmNyZWF0ZUNvbG9yKGxvY2FsUGxheWVyKSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZW5kZXJPbmUobG9jYWxQbGF5ZXI6IGFwcC5jb3JlLlBsYXllciwgbG9jYWxPcmlnaW46IGFwcC5jb3JlLklWZWN0b3IsIHN0eWxlOiBzdHJpbmcgfCBDYW52YXNHcmFkaWVudCB8IENhbnZhc1BhdHRlcm4pIHtcclxuICAgIGNvbnN0IGR4ID0gKGxvY2FsUGxheWVyLmxvY2FsT3JpZ2luLnZhbHVlLnggLSBsb2NhbE9yaWdpbi54KSAqIDAuMDI1NDtcclxuICAgIGNvbnN0IGR5ID0gKGxvY2FsUGxheWVyLmxvY2FsT3JpZ2luLnZhbHVlLnkgLSBsb2NhbE9yaWdpbi55KSAqIDAuMDI1NDtcclxuICAgIGNvbnN0IHIgPSBNYXRoLnNxcnQoTWF0aC5wb3coZHgsIDIpICsgTWF0aC5wb3coZHksIDIpKTtcclxuICAgIGlmIChyIDwgdGhpcy5tYXhpbXVtRGlzdGFuY2UpIHtcclxuICAgICAgY29uc3QgcyA9IHRoaXMub3V0ZXJSYWRpdXMgLyB0aGlzLm1heGltdW1EaXN0YW5jZTtcclxuICAgICAgY29uc3QgYSA9IE1hdGguc2lnbihkeSkgKiBNYXRoLmFjb3MoZHggLyByKSAtIGxvY2FsUGxheWVyLnZpZXdBbmdsZXMudmFsdWUueSAqIE1hdGguUEkgLyAxODA7XHJcbiAgICAgIGNvbnN0IHggPSB0aGlzLmNlbnRlclggKyBNYXRoLnNpbihhKSAqIHIgKiBzO1xyXG4gICAgICBjb25zdCB5ID0gdGhpcy5jZW50ZXJZICsgTWF0aC5jb3MoYSkgKiByICogcztcclxuICAgICAgdGhpcy5jb250ZXh0LmJlZ2luUGF0aCgpO1xyXG4gICAgICB0aGlzLmNvbnRleHQuYXJjKHgsIHksIHRoaXMub3V0ZXJSYWRpdXMgLyA0MCwgMCwgTWF0aC5QSSAqIDIpO1xyXG4gICAgICB0aGlzLmNvbnRleHQuZmlsbFN0eWxlID0gc3R5bGU7XHJcbiAgICAgIHRoaXMuY29udGV4dC5maWxsKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHJlbmRlckJhY2tncm91bmQoKSB7XHJcbiAgICB0aGlzLmNvbnRleHQuYmVnaW5QYXRoKCk7XHJcbiAgICB0aGlzLmNvbnRleHQuY2xlYXJSZWN0KDAsIDAsIHRoaXMuY2FudmFzLndpZHRoLCB0aGlzLmNhbnZhcy5oZWlnaHQpO1xyXG4gICAgdGhpcy5jb250ZXh0LmFyYyh0aGlzLmNlbnRlclgsIHRoaXMuY2VudGVyWSwgdGhpcy5vdXRlclJhZGl1cywgMCwgTWF0aC5QSSAqIDIpO1xyXG4gICAgdGhpcy5jb250ZXh0LmZpbGxTdHlsZSA9ICcjMDAwJztcclxuICAgIHRoaXMuY29udGV4dC5maWxsKCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHJlbmRlckxpbmVzKCkge1xyXG4gICAgdGhpcy5jb250ZXh0LnN0cm9rZVN0eWxlID0gJyNGRkYnO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCA4OyBpKyspIHtcclxuICAgICAgY29uc3QgeCA9IHRoaXMuY2VudGVyWCArIHRoaXMub3V0ZXJSYWRpdXMgKiBNYXRoLmNvcyhpICogTWF0aC5QSSAqIDAuMjUpO1xyXG4gICAgICBjb25zdCB5ID0gdGhpcy5jZW50ZXJZICsgdGhpcy5vdXRlclJhZGl1cyAqIE1hdGguc2luKGkgKiBNYXRoLlBJICogMC4yNSk7XHJcbiAgICAgIHRoaXMuY29udGV4dC5iZWdpblBhdGgoKTtcclxuICAgICAgdGhpcy5jb250ZXh0Lm1vdmVUbyh0aGlzLmNlbnRlclgsIHRoaXMuY2VudGVyWSk7XHJcbiAgICAgIHRoaXMuY29udGV4dC5saW5lVG8oeCwgeSk7XHJcbiAgICAgIHRoaXMuY29udGV4dC5zdHJva2UoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgcmVuZGVyUmluZ3MoKSB7XHJcbiAgICB0aGlzLmNvbnRleHQuc3Ryb2tlU3R5bGUgPSAnI0ZGRic7XHJcbiAgICBmb3IgKGxldCBpID0gMTsgaSA8PSB0aGlzLm51bWJlck9mUmluZ3M7IGkrKykge1xyXG4gICAgICB0aGlzLmNvbnRleHQuYmVnaW5QYXRoKCk7XHJcbiAgICAgIHRoaXMuY29udGV4dC5hcmModGhpcy5jZW50ZXJYLCB0aGlzLmNlbnRlclksIHRoaXMub3V0ZXJSYWRpdXMgKiBpIC8gdGhpcy5udW1iZXJPZlJpbmdzLCAwLCBNYXRoLlBJICogMik7XHJcbiAgICAgIHRoaXMuY29udGV4dC5zdHJva2UoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgdXBkYXRlKCkge1xyXG4gICAgdGhpcy5jZW50ZXJYID0gdGhpcy5jYW52YXMud2lkdGggLyAyO1xyXG4gICAgdGhpcy5jZW50ZXJZID0gdGhpcy5jYW52YXMuaGVpZ2h0IC8gMjtcclxuICAgIHRoaXMub3V0ZXJSYWRpdXMgPSAodGhpcy5jYW52YXMud2lkdGggPiB0aGlzLmNhbnZhcy5oZWlnaHQgPyB0aGlzLmNhbnZhcy5oZWlnaHQgOiB0aGlzLmNhbnZhcy53aWR0aCkgLyAyO1xyXG4gIH1cclxufVxyXG4iXX0=